#pragma config(Sensor, S4,     ColorSensor,    sensorEV3_Color)
#pragma config(Motor,  motorA,          rightMotor,    tmotorEV3_Large, PIDControl, driveRight, encoder)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//

// constants
#ifdef NOTROBOTC
const int ColorSensor = 0;
const int rightMotor = 0;
#endif
const unsigned int samplingDelay = 4;
const int speed = 10;


task main() {
	displayCenteredTextLine(3, "BARCODE SCANNER");

	// opening and writing into a datalog on robot
	datalogFlush();
	datalogClose();
	bool datalogOpenSuccess = datalogOpen(0, 1, false);
	if (!datalogOpenSuccess) {
		displayCenteredTextLine(6, "Unable to open datalog.");
	}
	else {
		displayCenteredTextLine(6, "");
	}

	// set all variables to 0
	unsigned int samplingCount = 0;
	int colorValue = 0;
	unsigned long scanCount = 0;

	// condition that is never met, motor is alwars reversed
	while(!getButtonPress(buttonAny)) {
		setMotorSpeed(rightMotor, -speed);

	// take samples according to delay
	if (samplingCount % samplingDelay == 0) {

			// manipulate data to be absolute
			colorValue = getColorReflected(ColorSensor);
			if(colorValue  >= 37) {
				datalogAddShort(0, 100);
			} else if (colorValue < 37) {
				datalogAddShort(0, 0);
			}

			// update variable for scans taken
			++scanCount;
			samplingCount = 0;
		}
		++samplingCount;
	}
	// close datalog
	datalogClose();
}
